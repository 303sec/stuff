#!/usr/bin/env python2

from pwn import *

context.update(arch="amd64", # arch="i386", arch="mips",
               endian="little", os="linux", log_level="debug", terminal=["tmux", "split-window", "-v", "-p 80"],)

LOCAL, REMOTE, SSH = False, False, False
TARGET="./bof"

elf = ELF(TARGET)


def exploit(r):
    if LOCAL:
        bkps = [elf.symbols["main"], ]
        cmds = []
        gdb.attach(r, '\n'.join(["break *{:#x}".format(x) for x in bkps] + cmds))

    pause()
    r.interactive()
    return


if __name__ == "__main__":
    process("clear")
    if "ssh" in args:
        SSH = True
        sh = ssh(user=args["user"], host=args["host"], port=args["port"], password=args["password"])
        cwd = sh.set_working_directory(os.path.dirname(TARGET))
        # s.run_to_end(cmd.split())
        r = sh.process([TARGET, ])
        log.info("Starting '{}' via ssh".format(TARGET))

    elif len(sys.argv)==3:
        REMOTE=True
        HOST, PORT = args[1], int(args[2])
        r = remote(HOST, PORT)
        log.info("Starting '{}' remotely".format(TARGET))

    else:
        LOCAL=True
        r = process([TARGET, ])
        log.info("Starting '{}' locally".format(TARGET))

    exploit(r)
    exit(0)
